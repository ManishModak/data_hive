var e=Object.defineProperty,t=(t,r,n)=>((t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n)(t,"symbol"!=typeof r?r+"":r,n);!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="a77305d2-dd3f-4233-a5ae-eaf88f6e77a6",e._sentryDebugIdIdentifier="sentry-dbid-a77305d2-dd3f-4233-a5ae-eaf88f6e77a6")}catch(r){}}();import"./modulepreload-polyfill-DBdoVHma.js";import{i as r}from"./init-sQey_HaX.js";import{v as n,s as a,r as o,n as s,E as i,a as l,c}from"./index-zDGX7_eg.js";import"./_sentry-release-injection-file-BetQGEEZ.js";import{T as d}from"./timeout-error-XFbXKjB0.js";import{m as u}from"./messenger-Bd6yZOQZ.js";import{d as m}from"./index-gLr4Bb9A.js";import"./types-Oyjdt06n.js";class h{constructor(e){t(this,"result"),this.result=e}get singleNodeValue(){const e=this.result.singleNodeValue;return e?new p(e):null}get snapshotLength(){return this.result.snapshotLength}snapshotItem(e){const t=this.result.snapshotItem(e);return t?new p(t):null}get stringValue(){return this.result.stringValue}}class p{constructor(e){t(this,"node"),this.node=e}get textContent(){return this.node.textContent}evaluate(e,t){const r=this.node.ownerDocument||this.node;return new h(r.evaluate(e,this.node,null,t,null))}cloneNode(e){return new p(this.node.cloneNode(e))}querySelectorAll(e){return this.node instanceof Element?Array.from(this.node.querySelectorAll(e)).map((e=>new p(e))):[]}getUnderlyingNode(){return this.node}}class g{constructor(e,r){t(this,"parser"),t(this,"document"),t(this,"baseUrl"),t(this,"ORDERED_NODE_SNAPSHOT_TYPE",XPathResult.ORDERED_NODE_SNAPSHOT_TYPE),t(this,"FIRST_ORDERED_NODE_TYPE",XPathResult.FIRST_ORDERED_NODE_TYPE),t(this,"STRING_TYPE",XPathResult.STRING_TYPE),this.parser=new DOMParser,this.document=this.parser.parseFromString(this.prepareHtml(e),"text/html"),this.baseUrl=n(r)}cleanup(){for(;this.document.documentElement.firstChild;)this.document.documentElement.removeChild(this.document.documentElement.firstChild);this.document.documentElement.innerHTML="",this.document=null,this.parser=null}prepareHtml(e){return e.replace(/<video/g,"<dh-video").replace(/<\/video>/g,"</dh-video>").replace(/<track/g,"<dh-track").replace(/<\/track>/g,"</dh-track>").replace(/<audio/g,"<dh-audio").replace(/<\/audio>/g,"</dh-audio>").replace(/<source/g,"<dh-source").replace(/<\/source>/g,"</dh-source>").replace(/<embed/g,"<dh-embed").replace(/<\/embed>/g,"</dh-embed>").replace(/<object/g,"<dh-object").replace(/<\/object>/g,"</dh-object>").replace(/<iframe/g,"<dh-iframe").replace(/<\/iframe>/g,"</dh-iframe>").replace(/<canvas/g,"<dh-canvas").replace(/<\/canvas>/g,"</dh-canvas>").replace(/<svg/g,"<dh-svg").replace(/<\/svg>/g,"</dh-svg>").replace(/<picture/g,"<dh-picture").replace(/<\/picture>/g,"</dh-picture>").replace(/<figure/g,"<dh-figure").replace(/<\/figure>/g,"</dh-figure>").replace(/<media/g,"<dh-media").replace(/<\/media>/g,"</dh-media>")}waitForPageLoad(){return Promise.resolve()}getDocument(){return new p(this.document)}getDocumentElement(){return new p(this.document.documentElement)}extractHtml(){return this.document.documentElement.outerHTML}extractUrls(){const e=Array.from(this.document.querySelectorAll("a")),t=new Set;for(const r of e){const e=r.getAttribute("href");if(!e||a(e))continue;const n=o(e,this.baseUrl);n&&t.add(s(n,{removeHash:!0}))}return Array.from(t)}extractPlainText(){var e;const t=this.document.body;if(!t)return"";const r=this.document.createTreeWalker(t,NodeFilter.SHOW_TEXT,{acceptNode:e=>{const t=e.parentElement;return t&&t.matches("script, style, noscript")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),n=[];let a=r.nextNode();for(;a;){const t=null==(e=a.textContent)?void 0:e.trim();t&&n.push(t),a=r.nextNode()}return n.join(" ").replace(/\s+/g," ").trim()}evaluateXPath(e,t,r){return new h(this.document.evaluate(e,t.getUnderlyingNode(),null,r,null))}async waitForElement(e,t){if(!this.document.evaluate(e,this.document,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null).singleNodeValue)throw new i(`Element with xpath ${e} not found in document`,l.NOT_FOUND,e,this.document.documentElement.outerHTML)}}const f=r();try{async function v(e,t,r){return new Promise(((n,a)=>{const o=1e3*(t.timeout||7),s=setTimeout((()=>{l(),a(new d(`Timeout: Data extraction took too (timeout: ${o}ms) long for URL: ${t.url}`))}),o);for(const e of document.querySelectorAll("iframe"))e.remove();const i=document.createElement("iframe");i.src=t.url,document.body.appendChild(i);const l=()=>{u.removeMessageListener(c),window.removeEventListener("message",h),document.body.contains(i)&&document.body.removeChild(i),i.remove(),clearTimeout(s)},c=u.handleMessage("offscreen.frame.dataExtracted",((t,o)=>{if(t.executionId===e){if(u.sendMessageWithoutResponse("performance.sample",{jobId:r,label:"dataExtracted"}),l(),u.sendMessageWithoutResponse("performance.sample",{jobId:r,label:"iframeCleanup"}),t.data)return void n(t.data);if(t.error)return void a(t.error)}}),!1);let m=!1;const h=n=>{var a;n.data&&"iframeReady"===n.data.action&&n.source===i.contentWindow&&(u.sendMessageWithoutResponse("performance.sample",{jobId:r,label:"iframeReady"}),window.removeEventListener("message",h),m||(m=!0,null==(a=i.contentWindow)||a.postMessage({action:"extractDataFromIframe",rules:t.rules,executionId:e},"*")))};window.addEventListener("message",h),i.onerror=()=>{l(),a(new Error(`Failed to load URL: ${t.url}`))}}))}setInterval((async()=>{var e;null==(e=(await navigator.serviceWorker.ready).active)||e.postMessage("keepAlive")}),2e4),u.handleMessage("offscreen.extractData",(async(e,t)=>({result:await v(e.executionId,e.params,e.jobId)}))),u.handleMessage("offscreen.parseHtml",(async(e,t)=>({result:await(async(e,t,r)=>{const n=new g(e,t);return c(n).extractDataByRulesWithCaptchaCheck(r).then((e=>e)).catch((e=>{throw e})).finally((()=>{n.cleanup()}))})(e.html,e.baseUrl,e.rules)}))),u.handleMessage("botDetection.detect",(async(e,t)=>({result:await m()})))}catch(E){f.captureException(E)}
